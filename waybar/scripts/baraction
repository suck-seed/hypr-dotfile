# #!/bin/sh

# Check which waybar theme is set
THEMEIS=$(readlink -f ~/.config/waybar/style.css | cut -d '-' -f2)


#if the theme is not dark then we need to switch to it
if [ $THEMEIS != "dark.css" ]; then
    SWITCHTO="-dark"
    ROSEPINE=""
else
    SWITCHTO=""
    ROSEPINE="-dawn"
fi

#set the waybar theme
ln -sf ~/.config/waybar/style/style$SWITCHTO.css ~/.config/waybar/style.css

# Change rofi theme
ln -sf ~/.config/rofi/style/style$SWITCHTO.rasi ~/.config/rofi/style.rasi

# Change theme of fastfetch
ln -sf ~/.config/fastfetch/style/style$SWITCHTO.jsonc ~/.config/fastfetch/config.jsonc

#set the xfce theme
xfconf-query -c xsettings -p /Net/ThemeName -s "Adwaita$SWITCHTO"
xfconf-query -c xsettings -p /Net/IconThemeName -s "Adwaita$SWITCHTO"




# ---------- GTK theming: Adwaita widgets + Adwaita icons ----------
if command -v gsettings >/dev/null 2>&1; then
  # Adwaita widgets: use Adwaita (light) or Adwaita-dark (dark)
  gsettings set org.gnome.desktop.interface gtk-theme  "Adwaita$SWITCHTO" || true
  # Adwaita icons (single set; no -dark variant)
  gsettings set org.gnome.desktop.interface icon-theme "Adwaita" || true

  # Libadwaita color-scheme (affects GTK4 apps like Nautilus)
  if [ "$SWITCHTO" = "-dark" ]; then
    gsettings set org.gnome.desktop.interface color-scheme "prefer-dark" || true
  else
    gsettings set org.gnome.desktop.interface color-scheme "default" || true
  fi
fi

# Ensure non-libadwaita GTK apps follow dark/light preference
GTK3_CONF="$HOME/.config/gtk-3.0/settings.ini"
GTK4_CONF="$HOME/.config/gtk-4.0/settings.ini"
mkdir -p "$(dirname "$GTK3_CONF")" "$(dirname "$GTK4_CONF")"

normalize_gtk_ini() {
  f="$1"
  [ -f "$f" ] || printf "[Settings]\n" >"$f"
  grep -q '^\[Settings\]' "$f" || sed -i '1i [Settings]' "$f"
  sed -i '/^gtk-application-prefer-dark-theme=/d' "$f"
  if [ "$SWITCHTO" = "-dark" ]; then
    printf "gtk-application-prefer-dark-theme=1\n" >> "$f"
  else
    printf "gtk-application-prefer-dark-theme=0\n" >> "$f"
  fi
}
normalize_gtk_ini "$GTK3_CONF"
normalize_gtk_ini "$GTK4_CONF"





































#change the background image and be cool about it ;)
BG_PATH="$HOME/.config/hypr/wallpapers/wallpaper.jpg"
ln -sf ~/.config/hypr/wallpapers/themes/images$SWITCHTO/link "$BG_PATH"
magick ~/.config/hypr/wallpapers/wallpaper.jpg -resize 2300x1294\> -quality 85 ~/.config/rofi/wallpaper.jpg
cp ~/.config/rofi/wallpaper.jpg ~/.config/wlogout/wallpaper.jpg
magick ~/.config/wlogout/wallpaper.jpg -blur 0x8 ~/.config/wlogout/wallpaper.jpg

swww img "$BG_PATH" --transition-type any --transition-duration 2

#update the sddm image
ln -sf /usr/share/sddm/themes/sdt/Backgrounds/wallpaper$SWITCHTO.jpg /usr/share/sddm/themes/sdt/wallpaper.jpg

# Hyprlock theme
ln -sf ~/.config/hypr/hyprlock/hyprlock$SWITCHTO.conf ~/.config/hypr/hyprlock.conf

#restart the waybar
killall -SIGUSR2 waybar
